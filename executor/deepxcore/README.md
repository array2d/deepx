# deepxcore

deepxcore 是 deepx 执行器层与统一存算面协议共享的 C++ 核心基础库。

它的目标是提供稳定、跨执行器可复用的数据模型与协议对象，避免把 CUDA/Metal/CPU 等具体实现细节渗透到上层与其他组件，从而保证进程间与代码组件的隔离。

## 定位
- 面向：执行器进程（heapmem-*、op-*）、统一存算面 SDK、调度/编译侧的 C++ 组件
- 提供：dtype/shape/tensor 等基础数据结构、协议对象的结构化表达、配置与序列化基础设施
- 不提供：具体硬件算子实现、显存/IPC 生命周期实现、调度编译逻辑

## 职责

### 1) 基础数据模型
- `DType`：数据类型描述与大小/对齐等基础能力
- `Shape`：维度/元素数量/bytes 计算、shape 合法性检查
- `Tensor`：Tensor 元信息与句柄表达（不绑定具体设备实现）

这些类型应作为所有执行器的共同语言，保证跨组件传递时语义一致。

### 2) 统一存算面协议对象
用于在统一寻址空间（如 Redis KV）与执行器之间传递的数据结构，例如：
- tensor 元信息记录（name/key、dtype、shape、device、bytes、ctime 等）
- 生命周期指令（create/get/delete 等）

deepxcore 只负责“结构化表达与编解码”，不负责“真正分配/回收/IPC 映射”。

### 3) 序列化/反序列化与配置
- 将协议对象、元信息在 JSON/YAML/二进制之间进行编解码
- 读取执行器/客户端的配置（例如地址、设备策略、协议版本等）

目标是让其他组件不要各自实现一套解析与校验逻辑。

### 4) 通用基础设施
- 轻量的错误与返回值表达（Status/Result）
- 字符串、文件系统等工具的薄封装

要求保持依赖尽量少、接口稳定、与具体硬件/运行时解耦。

## 非职责（边界）

### 不做硬件绑定
- 不直接依赖 CUDA/Metal/ROCm/NCCL 等
- 不实现任何具体算子 kernel

这些应由 `op-cuda`、`op-ompsimd`、`op-mem-mps` 等执行器承担。

### 不做堆 tensor 生命周期与 IPC
- 不管理持久堆 tensor 的分配/回收
- 不负责 CUDA IPC handle 的创建/打开/关闭

这些应由 `heapmem-cuda` 这类“统一寻址空间的 tensor 具体实现”承担。

### 不做编译与调度
- 不负责 deepxIR 的编译替换、fusion、分布式调度

这些属于中端编译器与调度器。

## 与其他组件的关系

- heapmem-*：owner 侧负责堆 tensor 生命周期与跨进程共享；deepxcore 提供 dtype/shape/协议对象
- op-*：算子执行器负责栈 tensor（中间变量）与 kernel；deepxcore 提供基础数据模型与统一的元信息表达
- 前端/SDK：通过统一协议把计算图与 tensor 元信息写入统一寻址空间；deepxcore 是 C++ 侧共用的协议层

## 目录
- `src/`：核心库实现
- `test/`：单元测试

## 构建
本库通过 CMake 构建，并作为其他执行器目标的依赖被链接。

在上层执行器中使用时，通常只需要链接 `deepxcore` 目标，并包含对应头文件。